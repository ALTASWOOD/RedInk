# 开发环境搭建指南

## 文档信息

| 项目 | 内容 |
|------|------|
| 文档版本 | V1.0 |
| 文档状态 | 已完成 |
| 创建日期 | 2026-02-28 |
| 最后更新 | 2026-02-28 |

---

## 1. 环境要求

### 1.1 操作系统

| 系统 | 最低版本 | 推荐版本 |
|------|----------|----------|
| Windows | Windows 10 20H2 | Windows 11 23H2 |
| macOS | macOS 11 Big Sur | macOS 14 Sonoma |
| Linux | Ubuntu 20.04 | Ubuntu 22.04 LTS |

### 1.2 必需软件

| 软件 | 版本要求 | 用途 |
|------|----------|------|
| Node.js | >= 20.0.0 LTS | JavaScript 运行时 |
| pnpm | >= 9.0.0 | 包管理器 |
| Rust | >= 1.77.0 | Tauri 后端编译 |
| Git | >= 2.40.0 | 版本控制 |
| VS Code | >= 1.85.0 | 推荐IDE |

### 1.3 可选软件

| 软件 | 用途 |
|------|------|
| Ollama | 本地AI服务（开发私域功能） |
| SQLite Browser | 数据库查看 |
| Postman | API测试 |

---

## 2. 环境安装

### 2.1 Node.js 安装

**Windows (推荐使用 nvm-windows)**

```powershell
# 1. 下载并安装 nvm-windows
# https://github.com/coreybutler/nvm-windows/releases

# 2. 安装 Node.js
nvm install 20.11.0
nvm use 20.11.0

# 3. 验证安装
node --version
# 预期输出: v20.11.0
```

**macOS (使用 nvm)**

```bash
# 1. 安装 nvm
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.7/install.sh | bash

# 2. 重启终端后安装 Node.js
nvm install 20.11.0
nvm use 20.11.0

# 3. 验证
node --version
```

### 2.2 pnpm 安装

```bash
# 全局安装 pnpm
npm install -g pnpm

# 验证安装
pnpm --version
# 预期输出: 9.x.x
```

### 2.3 Rust 安装

**Windows**

```powershell
# 1. 下载并运行 rustup-init.exe
# https://www.rust-lang.org/tools/install

# 2. 安装 Visual Studio Build Tools (自动提示)

# 3. 重启终端后验证
rustc --version
cargo --version
```

**macOS / Linux**

```bash
# 安装 Rust
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh

# 重启终端后验证
rustc --version
cargo --version
```

### 2.4 Tauri 依赖 (Windows)

```powershell
# Windows 需要安装 WebView2
# 通常 Windows 10/11 已预装
# 手动下载: https://developer.microsoft.com/microsoft-edge/webview2/

# 验证 WebView2
Get-ItemProperty -Path "HKLM:\SOFTWARE\WOW6432Node\Microsoft\EdgeUpdate\Clients\{F3017226-FE2A-4295-8BDF-00C3A9A7E4C5}"
```

### 2.5 Tauri 依赖 (macOS)

```bash
# 安装 Xcode Command Line Tools
xcode-select --install
```

### 2.6 Tauri 依赖 (Linux)

```bash
# Ubuntu/Debian
sudo apt update
sudo apt install libwebkit2gtk-4.1-dev \
  build-essential \
  curl \
  wget \
  file \
  libxdo-dev \
  libssl-dev \
  libayatana-appindicator3-dev \
  librsvg2-dev
```

---

## 3. 项目初始化

### 3.1 克隆项目

```bash
# 克隆仓库
git clone https://github.com/your-org/redink.git
cd redink

# 查看分支
git branch -a
```

### 3.2 安装依赖

```bash
# 安装项目依赖
pnpm install

# 如果遇到权限问题 (Windows)
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
```

### 3.3 环境变量配置

```bash
# 复制环境变量模板
cp .env.example .env.local

# 编辑 .env.local 文件
```

**.env.local 配置项**

```env
# 应用配置
VITE_APP_NAME=RedInk
VITE_APP_VERSION=1.0.0

# 开发服务器
VITE_DEV_SERVER_PORT=5173

# AI服务配置 (开发用)
VITE_OLLAMA_BASE_URL=http://localhost:11434
VITE_DEFAULT_MODEL=qwen:7b

# 日志级别
VITE_LOG_LEVEL=debug
```

### 3.4 启动开发服务

```bash
# 启动 Tauri 开发模式
pnpm tauri dev

# 仅启动前端开发服务 (不含 Tauri)
pnpm dev

# 启动前端并打开浏览器
pnpm dev --open
```

### 3.5 验证启动成功

启动成功后应看到:

```
  VITE v5.x.x  ready in xxx ms

  ➜  Local:   http://localhost:5173/
  ➜  Network: http://192.168.x.x:5173/
  
  [Tauri] Running: cargo build ...
```

---

## 4. VS Code 配置

### 4.1 推荐扩展

在项目根目录创建 `.vscode/extensions.json`:

```json
{
  "recommendations": [
    "vue.volar",
    "bradlc.vscode-tailwindcss",
    "dbaeumer.vscode-eslint",
    "esbenp.prettier-vscode",
    "rust-lang.rust-analyzer",
    "tauri-apps.tauri-vscode",
    "ms-ceintl.vscode-language-pack-zh-hans",
    "formulahendry.auto-rename-tag",
    "christian-kohler.path-intellisense",
    "antfu.iconify"
  ]
}
```

### 4.2 工作区设置

创建 `.vscode/settings.json`:

```json
{
  "editor.formatOnSave": true,
  "editor.defaultFormatter": "esbenp.prettier-vscode",
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": "explicit"
  },
  "typescript.preferences.importModuleSpecifier": "non-relative",
  "typescript.suggest.autoImports": true,
  "[typescript]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  },
  "[typescriptreact]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  },
  "[json]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  },
  "tailwindCSS.experimental.classRegex": [
    ["cva\\(([^)]*)\\)", "[\"'`]([^\"'`]*).*?[\"'`]"]
  ],
  "files.associations": {
    "*.css": "tailwindcss"
  }
}
```

### 4.3 调试配置

创建 `.vscode/launch.json`:

```json
{
  "version": "0.2.0",
  "configurations": [
    {
      "type": "chrome",
      "request": "launch",
      "name": "Launch Chrome (Dev)",
      "url": "http://localhost:5173",
      "webRoot": "${workspaceFolder}/src"
    },
    {
      "type": "lldb",
      "request": "launch",
      "name": "Debug Tauri",
      "cargo": {
        "args": ["build", "--manifest-path=./src-tauri/Cargo.toml"]
      },
      "preLaunchTask": "pnpm: dev"
    }
  ]
}
```

---

## 5. 项目结构

### 5.1 目录结构

```
redink/
├── .vscode/                 # VS Code 配置
├── docs/                    # 项目文档
├── public/                  # 静态资源
├── src/                     # 前端源码
│   ├── assets/              # 图片、字体等资源
│   ├── components/          # React 组件
│   │   ├── common/          # 通用组件
│   │   ├── editor/          # 编辑器组件
│   │   ├── ai/              # AI 相关组件
│   │   └── layout/          # 布局组件
│   ├── hooks/               # 自定义 Hooks
│   ├── pages/               # 页面组件
│   ├── services/            # 服务层 (API 调用)
│   ├── stores/              # Zustand 状态管理
│   ├── styles/              # 全局样式
│   ├── types/               # TypeScript 类型定义
│   ├── utils/               # 工具函数
│   ├── App.tsx              # 根组件
│   └── main.tsx             # 入口文件
├── src-tauri/               # Tauri 后端 (Rust)
│   ├── src/
│   │   ├── commands/        # Tauri 命令
│   │   ├── services/        # Rust 服务
│   │   └── main.rs          # Rust 入口
│   ├── Cargo.toml           # Rust 依赖
│   └── tauri.conf.json      # Tauri 配置
├── .env.example             # 环境变量模板
├── .eslintrc.cjs            # ESLint 配置
├── .prettierrc              # Prettier 配置
├── index.html               # HTML 入口
├── package.json             # 项目配置
├── pnpm-lock.yaml           # 依赖锁定
├── tailwind.config.js       # Tailwind 配置
├── tsconfig.json            # TypeScript 配置
└── vite.config.ts           # Vite 配置
```

### 5.2 关键配置文件说明

| 文件 | 说明 |
|------|------|
| `package.json` | 项目依赖和脚本 |
| `tsconfig.json` | TypeScript 编译配置 |
| `vite.config.ts` | Vite 构建配置 |
| `tailwind.config.js` | Tailwind CSS 配置 |
| `src-tauri/tauri.conf.json` | Tauri 应用配置 |
| `src-tauri/Cargo.toml` | Rust 依赖配置 |

---

## 6. 常用命令

### 6.1 开发命令

```bash
# 启动完整开发环境 (Tauri + Vite)
pnpm tauri dev

# 仅启动前端开发服务
pnpm dev

# 类型检查
pnpm typecheck

# 代码检查
pnpm lint

# 代码格式化
pnpm format

# 运行测试
pnpm test
```

### 6.2 构建命令

```bash
# 构建前端
pnpm build

# 构建 Tauri 应用
pnpm tauri build

# 构建特定平台
pnpm tauri build --target x86_64-pc-windows-msvc
```

### 6.3 清理命令

```bash
# 清理 node_modules
rm -rf node_modules
pnpm install

# 清理 Rust 构建缓存
cd src-tauri && cargo clean

# 清理所有缓存
pnpm clean
```

---

## 7. Ollama 本地服务 (私域开发)

### 7.1 安装 Ollama

**Windows**

```powershell
# 下载并安装 Ollama
# https://ollama.ai/download/windows

# 验证安装
ollama --version
```

**macOS**

```bash
# 使用 Homebrew
brew install ollama

# 或下载安装包
# https://ollama.ai/download/mac
```

### 7.2 拉取模型

```bash
# 拉取通义千问 7B 模型 (推荐开发用)
ollama pull qwen:7b

# 拉取更大模型 (需要更多内存)
ollama pull qwen:14b

# 查看已安装模型
ollama list
```

### 7.3 启动服务

```bash
# 启动 Ollama 服务
ollama serve

# 服务默认运行在 http://localhost:11434
```

### 7.4 验证服务

```bash
# 测试服务是否正常
curl http://localhost:11434/api/tags

# 测试模型调用
curl http://localhost:11434/api/generate -d '{
  "model": "qwen:7b",
  "prompt": "你好"
}'
```

---

## 8. 常见问题

### 8.1 Node.js 问题

**问题**: `npm ERR! ERESOLVE unable to resolve dependency tree`

**解决**:
```bash
# 使用 pnpm 代替 npm
pnpm install
```

### 8.2 Rust 编译问题

**问题**: `error: linker 'link.exe' not found`

**解决**:
```powershell
# 安装 Visual Studio Build Tools
# https://visualstudio.microsoft.com/visual-cpp-build-tools/
# 选择 "Desktop development with C++"
```

### 8.3 Tauri 问题

**问题**: `Error: WebView2 not found`

**解决**:
```powershell
# 手动安装 WebView2 Runtime
# https://developer.microsoft.com/microsoft-edge/webview2/
```

### 8.4 依赖安装慢

**解决**:
```bash
# 设置 npm 镜像
pnpm config set registry https://registry.npmmirror.com

# 设置 Rust 镜像 (编辑 ~/.cargo/config.toml)
[source.crates-io]
replace-with = "ustc"
[source.ustc]
registry = "sparse+https://mirrors.ustc.edu.cn/crates.io-index/"
```

---

## 9. 验证清单

完成环境搭建后，请验证以下项目:

| 验证项 | 命令 | 预期结果 |
|--------|------|----------|
| Node.js | `node --version` | v20.x.x |
| pnpm | `pnpm --version` | 9.x.x |
| Rust | `rustc --version` | 1.77.x |
| Git | `git --version` | 2.40.x |
| 依赖安装 | `pnpm install` | 无报错 |
| 开发启动 | `pnpm tauri dev` | 应用窗口打开 |
| Ollama | `ollama list` | 显示模型列表 |

---

*文档结束*
