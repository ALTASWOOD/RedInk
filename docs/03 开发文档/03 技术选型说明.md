# 技术选型说明

## 文档信息

| 项目 | 内容 |
|------|------|
| 文档版本 | V1.0 |
| 文档状态 | 已完成 |
| 创建日期 | 2026-02-28 |
| 最后更新 | 2026-02-28 |

---

## 1. 技术选型概览

### 1.1 技术栈总览

```
┌─────────────────────────────────────────────────────────────────────┐
│                         RedInk 技术架构                              │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │                      表现层 (Renderer)                       │   │
│  │  React 18 + TypeScript 5 + Ant Design 5.x + Tailwind CSS    │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                              ↓                                      │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │                      状态管理层                              │   │
│  │                        Zustand                               │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                              ↓                                      │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │                      桌面应用层                              │   │
│  │                      Tauri 2.x                               │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                              ↓                                      │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │                      数据存储层                              │   │
│  │                   SQLite (本地)                              │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

### 1.2 核心技术版本

| 技术 | 版本 | 说明 |
|------|------|------|
| Tauri | 2.x | 桌面应用框架 |
| React | 18.3.x | UI 框架 |
| TypeScript | 5.4.x | 类型系统 |
| Vite | 5.x | 构建工具 |
| Ant Design | 5.x | UI 组件库 |
| Tailwind CSS | 3.4.x | 原子化 CSS |
| Zustand | 4.x | 状态管理 |
| SQLite | 3.x | 本地数据库 |

---

## 2. 桌面框架选型

### 2.1 方案对比

| 特性 | Tauri | Electron | Flutter | Qt |
|------|-------|----------|---------|-----|
| 安装包大小 | ~3MB | ~150MB | ~15MB | ~30MB |
| 内存占用 | 低 | 高 | 中 | 中 |
| 启动速度 | 快 | 慢 | 中 | 中 |
| Web 技术栈 | ✅ | ✅ | ❌ | 部分 |
| 原生性能 | ✅ Rust | ❌ | ✅ | ✅ |
| 系统调用 | 强 | 中 | 中 | 强 |
| 生态成熟度 | 中 | 高 | 中 | 高 |
| 学习成本 | 中 | 低 | 高 | 高 |

### 2.2 选择 Tauri 的理由

1. **体积小**: 安装包仅 3-10MB，vs Electron 150MB+
2. **性能好**: 使用系统 WebView，内存占用低
3. **安全性**: Rust 后端，内存安全
4. **原生能力**: 强大的系统 API 访问能力
5. **本地存储**: 更好的文件系统访问支持
6. **隐私合规**: 无需捆绑浏览器内核

### 2.3 Tauri 架构

```
┌─────────────────────────────────────────────────────────────────────┐
│                         Tauri 应用架构                               │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  ┌─────────────────────────┐     ┌─────────────────────────┐       │
│  │    Renderer (Web)       │     │    Main Process (Rust)  │       │
│  │                         │     │                         │       │
│  │  • React 组件           │────→│  • 文件系统操作         │       │
│  │  • UI 渲染              │     │  • 数据库访问           │       │
│  │  • 用户交互             │←────│  • 系统调用             │       │
│  │                         │     │  • 加密解密             │       │
│  │  (WebView2/WebKitGTK)   │ IPC │  (Rust Binary)         │       │
│  └─────────────────────────┘     └─────────────────────────┘       │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 3. 前端框架选型

### 3.1 UI 框架对比

| 特性 | React | Vue 3 | Solid | Svelte |
|------|-------|-------|-------|--------|
| 生态成熟度 | 极高 | 高 | 中 | 中 |
| TypeScript | 优秀 | 优秀 | 优秀 | 良好 |
| 组件库丰富度 | 极高 | 高 | 低 | 低 |
| 性能 | 良好 | 良好 | 极佳 | 极佳 |
| 团队熟悉度 | 高 | 高 | 低 | 低 |
| 招聘难度 | 低 | 低 | 高 | 高 |

### 3.2 选择 React 的理由

1. **生态成熟**: 丰富的第三方库和组件
2. **类型支持**: 与 TypeScript 深度集成
3. **组件库**: Ant Design 提供完整的企业级组件
4. **Hooks**: 强大的逻辑复用能力
5. **社区活跃**: 问题易解决，资源丰富

### 3.3 组件库选型

| 组件库 | 优势 | 劣势 |
|--------|------|------|
| Ant Design | 企业级、组件全、文档好 | 体积较大、定制稍复杂 |
| MUI | 设计美观、高度可定制 | 学习成本高 |
| Chakra UI | API 简洁、主题灵活 | 组件不够丰富 |
| shadcn/ui | 可复制源码、高度可控 | 需自行维护 |

**选择**: Ant Design 5.x
- 公文系统偏向企业应用，Ant Design 风格契合
- 表格、表单、树等复杂组件成熟稳定
- 支持按需加载，可控制体积

---

## 4. 状态管理选型

### 4.1 方案对比

| 特性 | Zustand | Redux Toolkit | Jotai | MobX |
|------|---------|---------------|-------|------|
| 学习成本 | 低 | 中 | 低 | 中 |
| 样板代码 | 少 | 中 | 少 | 中 |
| TypeScript | 优秀 | 优秀 | 优秀 | 良好 |
| 性能 | 优秀 | 良好 | 优秀 | 优秀 |
| 中间件 | 支持 | 丰富 | 有限 | 丰富 |
| DevTools | 支持 | 优秀 | 支持 | 支持 |
| 包大小 | ~1KB | ~40KB | ~2KB | ~50KB |

### 4.2 选择 Zustand 的理由

1. **简洁**: 极简的 API，几行代码即可上手
2. **轻量**: 仅 1KB，对打包体积友好
3. **灵活**: 不强制模式，可按需组织
4. **TypeScript**: 原生支持，类型推断完美
5. **无模板**: 无 Provider、无 Reducer 样板

### 4.3 Zustand 使用示例

```typescript
// 简洁的 Store 定义
interface DocumentStore {
  documents: Document[];
  current: Document | null;
  isLoading: boolean;
  
  loadDocuments: () => Promise<void>;
  selectDocument: (id: string) => void;
}

const useDocumentStore = create<DocumentStore>((set, get) => ({
  documents: [],
  current: null,
  isLoading: false,

  loadDocuments: async () => {
    set({ isLoading: true });
    const documents = await api.getDocuments();
    set({ documents, isLoading: false });
  },

  selectDocument: (id) => {
    const current = get().documents.find(d => d.id === id) ?? null;
    set({ current });
  },
}));
```

---

## 5. 数据库选型

### 5.1 方案对比

| 特性 | SQLite | IndexedDB | LevelDB | PouchDB |
|------|--------|-----------|---------|---------|
| 数据模型 | 关系型 | NoSQL | KV | 文档 |
| SQL 支持 | ✅ | ❌ | ❌ | ❌ |
| 事务 | 完整 | 有限 | 有限 | 有限 |
| 性能 | 优秀 | 良好 | 优秀 | 良好 |
| 文件导出 | 简单 | 复杂 | 复杂 | 复杂 |
| 跨平台 | ✅ | 仅浏览器 | ✅ | ✅ |
| 容量限制 | 无 | 受限 | 无 | 无 |
| 加密支持 | 扩展 | 有限 | 有限 | 有限 |

### 5.2 选择 SQLite 的理由

1. **成熟稳定**: 全球最广泛使用的嵌入式数据库
2. **单文件**: 整个数据库一个文件，便于备份迁移
3. **SQL 支持**: 结构化查询，全文搜索 (FTS5)
4. **零配置**: 无需服务器，嵌入式运行
5. **Tauri 集成**: 通过 tauri-plugin-sql 无缝集成
6. **容量无限**: 单库支持 281TB

### 5.3 SQLite 配置

```rust
// src-tauri/src/main.rs
use tauri_plugin_sql::{Migration, MigrationKind};

fn main() {
    tauri::Builder::default()
        .plugin(
            tauri_plugin_sql::Builder::default()
                .add_migrations(
                    "sqlite:redink.db",
                    vec![
                        Migration {
                            version: 1,
                            description: "create_initial_tables",
                            sql: include_str!("../migrations/001_init.sql"),
                            kind: MigrationKind::Up,
                        },
                    ],
                )
                .build(),
        )
        .run(tauri::generate_context!())
        .expect("error while running tauri application");
}
```

---

## 6. AI 服务集成

### 6.1 支持的 AI 服务

| 服务 | 环境 | 协议 | 特点 |
|------|------|------|------|
| OpenAI | 公网 | REST | GPT-4, GPT-3.5 |
| Claude | 公网 | REST | Anthropic Claude 3 |
| 通义千问 | 公网 | REST | 阿里云，国内访问快 |
| 文心一言 | 公网 | REST | 百度，中文优化 |
| 讯飞星火 | 公网 | WebSocket | 科大讯飞 |
| Ollama | 私域 | REST | 本地部署，完全离线 |
| LM Studio | 私域 | REST | 本地GUI，易用 |

### 6.2 适配器模式

```typescript
// 统一的 AI 适配器接口
interface IAIAdapter {
  readonly id: string;
  readonly name: string;
  readonly environmentType: 'public' | 'private';

  // 健康检查
  healthCheck(): Promise<boolean>;
  
  // 内容生成
  generate(request: GenerateRequest): Promise<GenerateResponse>;
  generateStream(request: GenerateRequest, onChunk: (chunk: string) => void): Promise<void>;
  
  // 内容审核
  review(request: ReviewRequest): Promise<ReviewResponse>;
}

// 工厂方法
function createAIAdapter(config: AIConfig): IAIAdapter {
  switch (config.provider) {
    case 'openai':
      return new OpenAIAdapter(config);
    case 'claude':
      return new ClaudeAdapter(config);
    case 'ollama':
      return new OllamaAdapter(config);
    // ...
  }
}
```

---

## 7. 构建工具

### 7.1 Vite 选型理由

| 特性 | Vite | Webpack | Parcel |
|------|------|---------|--------|
| 冷启动 | 极快 | 慢 | 中 |
| HMR | 极快 | 中 | 快 |
| 配置复杂度 | 低 | 高 | 低 |
| 生态 | 丰富 | 极丰富 | 中 |
| 生产构建 | Rollup | 自有 | 自有 |

**选择 Vite**:
- 开发体验极佳，秒级启动
- 原生 ESM 支持，按需编译
- 配置简单，开箱即用
- 与 Tauri 官方推荐集成

### 7.2 Vite 配置

```typescript
// vite.config.ts
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react-swc';
import path from 'path';

export default defineConfig({
  plugins: [react()],
  
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src'),
    },
  },

  // Tauri 开发服务器配置
  clearScreen: false,
  server: {
    port: 5173,
    strictPort: true,
    watch: {
      ignored: ['**/src-tauri/**'],
    },
  },

  build: {
    target: ['es2021', 'chrome100', 'safari13'],
    minify: !process.env.TAURI_DEBUG ? 'esbuild' : false,
    sourcemap: !!process.env.TAURI_DEBUG,
  },
});
```

---

## 8. 样式方案

### 8.1 Tailwind CSS + Ant Design

```
┌─────────────────────────────────────────────────────────────────────┐
│                         样式架构                                     │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │                    Ant Design 组件                           │   │
│  │              (表格、表单、对话框、菜单等)                     │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                              +                                      │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │                   Tailwind CSS                               │   │
│  │              (布局、间距、自定义样式)                         │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                              +                                      │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │                   CSS Variables                              │   │
│  │              (环境主题色、动态切换)                           │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

### 8.2 主题配置

```typescript
// tailwind.config.js
module.exports = {
  content: ['./index.html', './src/**/*.{js,ts,jsx,tsx}'],
  theme: {
    extend: {
      colors: {
        // 环境主题色 (CSS变量)
        'env-primary': 'var(--env-primary)',
        'env-primary-foreground': 'var(--env-primary-foreground)',
        
        // 私域环境色
        'private': {
          DEFAULT: '#52C41A',
          light: '#E6F7E9',
          dark: '#389E0D',
        },
        
        // 公网环境色
        'public': {
          DEFAULT: '#1890FF',
          light: '#E6F7FF',
          dark: '#096DD9',
        },
      },
    },
  },
  plugins: [],
};
```

---

## 9. 技术风险与应对

### 9.1 风险识别

| 风险 | 概率 | 影响 | 应对措施 |
|------|------|------|----------|
| Tauri 2.x 稳定性 | 低 | 高 | 锁定版本，关注更新 |
| WebView 兼容性 | 中 | 中 | 充分测试各平台 |
| Ollama 模型质量 | 中 | 中 | 提供多模型选择 |
| SQLite 并发限制 | 低 | 低 | WAL 模式优化 |

### 9.2 技术债务管理

- 每个迭代预留 20% 时间处理技术债务
- 建立代码审查机制
- 定期更新依赖版本
- 维护技术文档

---

*文档结束*
