# 运维手册

## 文档信息

| 项目 | 内容 |
|------|------|
| 文档版本 | V1.0 |
| 创建日期 | 2026-02-28 |

---

## 1. 日常运维

### 1.1 健康检查

```bash
# 检查应用进程
# Windows
tasklist | findstr RedInk

# macOS/Linux
ps aux | grep RedInk

# 检查 Ollama 服务
curl -s http://localhost:11434/api/tags
```

### 1.2 日志查看

| 平台 | 日志位置 |
|------|----------|
| Windows | `%APPDATA%\com.redink.app\logs\` |
| macOS | `~/Library/Application Support/com.redink.app/logs/` |
| Linux | `~/.local/share/com.redink.app/logs/` |

```bash
# 查看最新日志
tail -f ~/.local/share/com.redink.app/logs/app.log
```

---

## 2. 数据备份

### 2.1 备份内容

- `redink.db` - SQLite 数据库
- `config.json` - 配置文件

### 2.2 备份命令

```bash
# Linux/macOS
DATA_DIR="$HOME/.local/share/com.redink.app"
BACKUP_DIR="$HOME/redink_backup/$(date +%Y%m%d)"
mkdir -p "$BACKUP_DIR"
cp "$DATA_DIR/redink.db" "$BACKUP_DIR/"
cp "$DATA_DIR/config.json" "$BACKUP_DIR/"

# Windows PowerShell
$dataDir = "$env:APPDATA\com.redink.app"
$backupDir = "$env:USERPROFILE\redink_backup\$(Get-Date -Format 'yyyyMMdd')"
New-Item -ItemType Directory -Force -Path $backupDir
Copy-Item "$dataDir\redink.db" $backupDir
Copy-Item "$dataDir\config.json" $backupDir
```

### 2.3 自动备份 (定时任务)

```bash
# Linux crontab
0 2 * * * /path/to/backup_redink.sh

# Windows 任务计划程序
schtasks /create /sc daily /tn "RedInk Backup" /tr "powershell backup.ps1" /st 02:00
```

---

## 3. 数据恢复

### 3.1 恢复步骤

```bash
# 1. 停止应用
# 2. 替换数据文件
cp backup/redink.db ~/.local/share/com.redink.app/
# 3. 重启应用
```

### 3.2 验证恢复

- 检查文档列表是否恢复
- 检查配置是否正确

---

## 4. 性能监控

### 4.1 资源监控

```bash
# 内存使用
# Windows
wmic process where name="RedInk.exe" get WorkingSetSize

# Linux
ps -o pid,rss,comm -p $(pgrep RedInk)

# macOS
top -pid $(pgrep RedInk)
```

### 4.2 数据库优化

```sql
-- 执行 VACUUM 压缩数据库
VACUUM;

-- 分析统计信息
ANALYZE;

-- 检查数据库完整性
PRAGMA integrity_check;
```

---

## 5. 故障处理

### 5.1 应用无法启动

```
1. 检查日志文件
2. 尝试删除配置文件重置
3. 重新安装应用
```

### 5.2 数据库损坏

```bash
# 尝试修复
sqlite3 redink.db "PRAGMA integrity_check;"

# 从备份恢复
cp backup/redink.db ~/.local/share/com.redink.app/
```

### 5.3 AI服务不可用

```bash
# 检查 Ollama 状态
systemctl status ollama  # Linux
ollama serve             # 手动启动

# 检查端口
netstat -an | grep 11434
```

---

## 6. 安全运维

### 6.1 定期检查

- [ ] 审计日志审查
- [ ] 敏感检测规则更新
- [ ] 配置文件权限检查

### 6.2 日志清理

```bash
# 清理30天前的日志
find ~/.local/share/com.redink.app/logs -mtime +30 -delete
```

---

## 7. 联系支持

| 问题类型 | 联系方式 |
|----------|----------|
| 技术支持 | support@redink.app |
| Bug报告 | GitHub Issues |

---

*文档结束*
