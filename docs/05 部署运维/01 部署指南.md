# 部署指南

## 文档信息

| 项目 | 内容 |
|------|------|
| 文档版本 | V1.0 |
| 创建日期 | 2026-02-28 |

---

## 1. 部署概述

### 1.1 部署架构

```
┌─────────────────────────────────────────────────────────────────────┐
│                         部署架构                                     │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│    用户设备                           可选外部服务                   │
│  ┌─────────────────┐               ┌─────────────────┐             │
│  │   RedInk App    │◄─────────────►│  公网AI服务     │             │
│  │  (Tauri桌面)    │  (公网环境)   │  (API调用)      │             │
│  └────────┬────────┘               └─────────────────┘             │
│           │                                                         │
│           │ (私域环境)                                              │
│           │                                                         │
│  ┌────────▼────────┐                                               │
│  │   Ollama服务    │                                               │
│  │   (本地部署)    │                                               │
│  └─────────────────┘                                               │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

### 1.2 部署模式

| 模式 | 说明 | 适用场景 |
|------|------|----------|
| 单机部署 | 应用+本地AI | 个人用户、离线环境 |
| 混合部署 | 应用+本地AI+公网AI | 企业用户、按需调用 |

---

## 2. 构建安装包

### 2.1 构建命令

```bash
# 进入项目目录
cd redink

# 安装依赖
pnpm install

# 构建所有平台
pnpm tauri build

# 构建特定平台
pnpm tauri build --target x86_64-pc-windows-msvc      # Windows
pnpm tauri build --target x86_64-apple-darwin         # macOS Intel
pnpm tauri build --target aarch64-apple-darwin        # macOS M1/M2
pnpm tauri build --target x86_64-unknown-linux-gnu    # Linux
```

### 2.2 构建产物

| 平台 | 产物位置 | 格式 |
|------|----------|------|
| Windows | `src-tauri/target/release/bundle/msi/` | .msi, .exe |
| macOS | `src-tauri/target/release/bundle/dmg/` | .dmg, .app |
| Linux | `src-tauri/target/release/bundle/` | .deb, .AppImage |

---

## 3. Windows 部署

### 3.1 系统要求

- Windows 10 (1803+) 或 Windows 11
- WebView2 Runtime (通常已预装)
- 4GB RAM 以上

### 3.2 安装步骤

```
1. 双击 RedInk_x.x.x_x64.msi 或 RedInk_x.x.x_x64_en-US.msi
2. 按照安装向导完成安装
3. 从开始菜单或桌面快捷方式启动
```

### 3.3 静默安装

```powershell
# MSI 静默安装
msiexec /i RedInk_x.x.x_x64.msi /quiet

# NSIS 静默安装
RedInk_x.x.x_x64-setup.exe /S
```

### 3.4 卸载

```
控制面板 > 程序和功能 > 找到 RedInk > 卸载
```

---

## 4. macOS 部署

### 4.1 系统要求

- macOS 11 Big Sur 或更高版本
- 4GB RAM 以上

### 4.2 安装步骤

```
1. 双击 RedInk_x.x.x_x64.dmg
2. 将 RedInk.app 拖入 Applications 文件夹
3. 从 Launchpad 或 Applications 启动
```

### 4.3 首次运行

由于未经 Apple 公证，首次运行需要:

```bash
# 方法1: 右键点击 app，选择"打开"
# 方法2: 命令行解除限制
xattr -cr /Applications/RedInk.app
```

---

## 5. Linux 部署

### 5.1 系统要求

- Ubuntu 20.04+ / Debian 10+ / Fedora 32+
- WebKitGTK 4.1
- 4GB RAM 以上

### 5.2 Debian/Ubuntu 安装

```bash
# 安装 deb 包
sudo dpkg -i redink_x.x.x_amd64.deb

# 安装依赖 (如果有缺失)
sudo apt-get install -f
```

### 5.3 AppImage 运行

```bash
# 添加执行权限
chmod +x RedInk_x.x.x_amd64.AppImage

# 直接运行
./RedInk_x.x.x_amd64.AppImage
```

---

## 6. 数据目录

### 6.1 数据存储位置

| 平台 | 应用数据目录 |
|------|-------------|
| Windows | `%APPDATA%\com.redink.app\` |
| macOS | `~/Library/Application Support/com.redink.app/` |
| Linux | `~/.local/share/com.redink.app/` |

### 6.2 目录结构

```
com.redink.app/
├── redink.db          # SQLite 数据库
├── config.json        # 配置文件
├── logs/              # 日志目录
└── backups/           # 备份目录
```

---

## 7. 企业部署

### 7.1 批量部署脚本 (Windows)

```powershell
# deploy.ps1
$installerPath = "\\server\share\RedInk_x.x.x_x64.msi"
$logPath = "C:\Logs\redink_install.log"

Start-Process msiexec.exe -ArgumentList "/i `"$installerPath`" /quiet /log `"$logPath`"" -Wait
```

### 7.2 预配置

```json
// 预配置文件 config.json
{
  "default_environment": "private",
  "sensitive_detection_enabled": true,
  "ai_provider_private": {
    "type": "ollama",
    "baseUrl": "http://ai-server.internal:11434"
  }
}
```

---

## 8. 验证安装

### 8.1 检查清单

- [ ] 应用正常启动
- [ ] 界面显示正确
- [ ] 可创建新文档
- [ ] 本地AI服务连接正常 (如已部署)
- [ ] 数据能正常保存

### 8.2 常见问题

| 问题 | 解决方案 |
|------|----------|
| Windows 提示 WebView2 缺失 | 下载安装 WebView2 Runtime |
| macOS 无法打开 | 执行 `xattr -cr` 命令 |
| Linux 缺少依赖 | 执行 `apt-get install -f` |

---

*文档结束*
