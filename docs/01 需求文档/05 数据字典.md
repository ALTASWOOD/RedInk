# 数据字典

## 文档信息

| 项目 | 内容 |
|------|------|
| 文档版本 | V1.0 |
| 文档状态 | 已完成 |
| 创建日期 | 2026-02-28 |
| 最后更新 | 2026-02-28 |

---

## 目录

1. [业务术语定义](#1-业务术语定义)
2. [数据实体定义](#2-数据实体定义)
3. [数据元素定义](#3-数据元素定义)
4. [代码表定义](#4-代码表定义)
5. [数据关系定义](#5-数据关系定义)

---

## 1. 业务术语定义

### 1.1 核心业务术语

| 术语 | 英文 | 定义 | 示例 |
|------|------|------|------|
| 公文 | Official Document | 机关、团体、企事业单位在公务活动中形成的具有法定效力和规范格式的文书 | 通知、报告、请示 |
| 公网环境 | Public Environment | 通过互联网访问云端AI服务的工作环境，数据经过公网传输 | 使用OpenAI、通义千问等云端服务 |
| 私域环境 | Private Environment | 仅使用本地部署AI服务的工作环境，数据不经过公网传输 | 使用Ollama本地模型 |
| 模板 | Template | 预定义的公文格式和结构，包含标题、正文等格式规范 | 通知模板、报告模板 |
| 素材 | Material | 公文编写中可复用的文字、图片等内容 | 常用短语、段落模板 |

### 1.2 AI相关术语

| 术语 | 英文 | 定义 | 说明 |
|------|------|------|------|
| AI提供商 | AI Provider | 提供大语言模型服务的服务商 | OpenAI、阿里云、本地Ollama |
| Token | Token | AI模型处理文本的基本单位 | 约0.75个中文字符 |
| 会话 | Session | 用户与AI之间的一次完整交互过程 | 包含多轮对话消息 |
| 审核 | Audit | AI对公文内容和格式进行检查的过程 | 内容审核、格式审核 |

### 1.3 文档状态术语

| 术语 | 英文 | 定义 | 状态流转 |
|------|------|------|----------|
| 草稿 | Draft | 文档初始或编辑中状态 | → 审核中/已完成 |
| 审核中 | Reviewing | 文档正在进行AI审核 | → 草稿/已完成 |
| 已完成 | Final | 文档编写和审核已完成 | → 草稿（重新编辑） |

---

## 2. 数据实体定义

### 2.1 实体清单

| 实体名称 | 英文名 | 描述 | 主键 |
|----------|--------|------|------|
| 文档 | Document | 用户创建的公文文档 | id (UUID) |
| 模板 | Template | 公文格式模板 | id (UUID) |
| 图表 | Chart | 文档中的图表 | id (UUID) |
| AI会话 | AISession | AI交互会话 | id (UUID) |
| 消息 | Message | AI对话消息 | id (UUID) |
| 审核记录 | AuditRecord | 文档审核记录 | id (UUID) |
| 用户配置 | UserConfig | 用户设置配置 | key |
| 审计日志 | AuditLog | 操作日志记录 | id (UUID) |

### 2.2 文档实体 (Document)

| 属性名 | 英文名 | 数据类型 | 长度 | 必填 | 默认值 | 说明 |
|--------|--------|----------|------|------|--------|------|
| 文档ID | id | TEXT | 36 | 是 | UUID | 主键 |
| 标题 | title | TEXT | 200 | 是 | - | 文档标题 |
| 内容 | content | TEXT | - | 否 | - | JSON格式文档内容 |
| 纯文本内容 | content_text | TEXT | - | 否 | - | 用于全文搜索 |
| 文档类型 | doc_type | TEXT | 20 | 是 | - | 见代码表CT-001 |
| 模板ID | template_id | TEXT | 36 | 否 | - | 关联模板 |
| 状态 | status | TEXT | 20 | 是 | draft | 见代码表CT-002 |
| 环境 | environment | TEXT | 10 | 是 | - | 见代码表CT-003 |
| 字数 | word_count | INTEGER | - | 否 | 0 | 自动统计 |
| 标签 | tags | TEXT | - | 否 | - | JSON数组 |
| 元数据 | metadata | TEXT | - | 否 | - | JSON对象 |
| 创建时间 | created_at | DATETIME | - | 是 | 当前时间 | - |
| 更新时间 | updated_at | DATETIME | - | 是 | 当前时间 | - |
| 删除时间 | deleted_at | DATETIME | - | 否 | - | 软删除标记 |

### 2.3 模板实体 (Template)

| 属性名 | 英文名 | 数据类型 | 长度 | 必填 | 默认值 | 说明 |
|--------|--------|----------|------|------|--------|------|
| 模板ID | id | TEXT | 36 | 是 | UUID | 主键 |
| 名称 | name | TEXT | 50 | 是 | - | 模板名称 |
| 分类 | category | TEXT | 20 | 是 | - | 见代码表CT-001 |
| 描述 | description | TEXT | 500 | 否 | - | 模板说明 |
| 内容 | content | TEXT | - | 是 | - | JSON格式模板内容 |
| 格式配置 | format_config | TEXT | - | 否 | - | JSON格式配置 |
| 示例内容 | example_content | TEXT | - | 否 | - | 使用示例 |
| 是否内置 | is_builtin | INTEGER | - | 是 | 0 | 0否1是 |
| 是否收藏 | is_favorite | INTEGER | - | 是 | 0 | 0否1是 |
| 使用次数 | use_count | INTEGER | - | 否 | 0 | 自动统计 |
| 创建时间 | created_at | DATETIME | - | 是 | 当前时间 | - |
| 更新时间 | updated_at | DATETIME | - | 是 | 当前时间 | - |

### 2.4 图表实体 (Chart)

| 属性名 | 英文名 | 数据类型 | 长度 | 必填 | 默认值 | 说明 |
|--------|--------|----------|------|------|--------|------|
| 图表ID | id | TEXT | 36 | 是 | UUID | 主键 |
| 文档ID | document_id | TEXT | 36 | 否 | - | 关联文档 |
| 名称 | name | TEXT | 100 | 否 | - | 图表名称 |
| 类型 | chart_type | TEXT | 20 | 是 | - | 见代码表CT-004 |
| 数据 | data | TEXT | - | 是 | - | JSON格式图表数据 |
| 样式 | style | TEXT | - | 否 | - | JSON样式配置 |
| SVG内容 | svg_content | TEXT | - | 否 | - | 渲染结果 |
| 位置 | position | TEXT | - | 否 | - | 文档中的位置 |
| 创建时间 | created_at | DATETIME | - | 是 | 当前时间 | - |
| 更新时间 | updated_at | DATETIME | - | 是 | 当前时间 | - |

### 2.5 AI会话实体 (AISession)

| 属性名 | 英文名 | 数据类型 | 长度 | 必填 | 默认值 | 说明 |
|--------|--------|----------|------|------|--------|------|
| 会话ID | id | TEXT | 36 | 是 | UUID | 主键 |
| 文档ID | document_id | TEXT | 36 | 否 | - | 关联文档 |
| 环境 | environment | TEXT | 10 | 是 | - | 见代码表CT-003 |
| AI提供商 | ai_provider | TEXT | 50 | 是 | - | 提供商标识 |
| AI模型 | ai_model | TEXT | 50 | 否 | - | 模型名称 |
| 会话类型 | session_type | TEXT | 20 | 是 | - | 见代码表CT-005 |
| Token用量 | token_used | INTEGER | - | 否 | 0 | 累计Token |
| 开始时间 | started_at | DATETIME | - | 是 | 当前时间 | - |
| 结束时间 | ended_at | DATETIME | - | 否 | - | 会话结束时间 |

### 2.6 消息实体 (Message)

| 属性名 | 英文名 | 数据类型 | 长度 | 必填 | 默认值 | 说明 |
|--------|--------|----------|------|------|--------|------|
| 消息ID | id | TEXT | 36 | 是 | UUID | 主键 |
| 会话ID | session_id | TEXT | 36 | 是 | - | 关联会话 |
| 角色 | role | TEXT | 20 | 是 | - | 见代码表CT-006 |
| 内容 | content | TEXT | - | 是 | - | 消息内容 |
| Token数 | token_count | INTEGER | - | 否 | 0 | 消息Token数 |
| 创建时间 | created_at | DATETIME | - | 是 | 当前时间 | - |

### 2.7 审核记录实体 (AuditRecord)

| 属性名 | 英文名 | 数据类型 | 长度 | 必填 | 默认值 | 说明 |
|--------|--------|----------|------|------|--------|------|
| 记录ID | id | TEXT | 36 | 是 | UUID | 主键 |
| 文档ID | document_id | TEXT | 36 | 是 | - | 关联文档 |
| 会话ID | session_id | TEXT | 36 | 否 | - | 关联AI会话 |
| 审核类型 | audit_type | TEXT | 20 | 是 | - | 见代码表CT-007 |
| 是否通过 | passed | INTEGER | - | 是 | - | 0未通过1通过 |
| 得分 | score | INTEGER | - | 否 | - | 0-100分 |
| 问题列表 | issues | TEXT | - | 否 | - | JSON数组 |
| 建议列表 | suggestions | TEXT | - | 否 | - | JSON数组 |
| AI原始响应 | raw_response | TEXT | - | 否 | - | 原始返回 |
| 创建时间 | created_at | DATETIME | - | 是 | 当前时间 | - |

### 2.8 用户配置实体 (UserConfig)

| 属性名 | 英文名 | 数据类型 | 长度 | 必填 | 默认值 | 说明 |
|--------|--------|----------|------|------|--------|------|
| 配置键 | key | TEXT | 100 | 是 | - | 主键 |
| 配置值 | value | TEXT | - | 是 | - | JSON格式 |
| 分类 | category | TEXT | 20 | 是 | - | 见代码表CT-008 |
| 是否加密 | encrypted | INTEGER | - | 是 | 0 | 0否1是 |
| 更新时间 | updated_at | DATETIME | - | 是 | 当前时间 | - |

### 2.9 审计日志实体 (AuditLog)

| 属性名 | 英文名 | 数据类型 | 长度 | 必填 | 默认值 | 说明 |
|--------|--------|----------|------|------|--------|------|
| 日志ID | id | TEXT | 36 | 是 | UUID | 主键 |
| 事件类型 | event_type | TEXT | 50 | 是 | - | 见代码表CT-009 |
| 环境 | environment | TEXT | 10 | 是 | - | 见代码表CT-003 |
| 详情 | details | TEXT | - | 否 | - | JSON详细信息 |
| 用户ID | user_id | TEXT | 36 | 否 | - | 预留字段 |
| 创建时间 | created_at | DATETIME | - | 是 | 当前时间 | - |

---

## 3. 数据元素定义

### 3.1 通用数据元素

| 元素名 | 数据类型 | 格式 | 长度 | 示例 |
|--------|----------|------|------|------|
| UUID | TEXT | UUID v4 | 36 | "550e8400-e29b-41d4-a716-446655440000" |
| 时间戳 | DATETIME | ISO 8601 | - | "2026-02-28T10:30:00" |
| 布尔值 | INTEGER | 0/1 | 1 | 0=否, 1=是 |
| JSON对象 | TEXT | JSON | - | {"key": "value"} |
| JSON数组 | TEXT | JSON | - | ["item1", "item2"] |

### 3.2 文档内容结构

```typescript
// 文档内容 (Document.content) 结构定义
{
  "version": "1.0",                    // 内容版本
  "blocks": [                          // 内容块数组
    {
      "id": "block-uuid",              // 块ID
      "type": "title|paragraph|list",  // 块类型
      "content": "文本内容",            // 块内容
      "style": {}                      // 样式配置
    }
  ],
  "meta": {                            // 文档元信息
    "format": "official",              // 格式类型
    "pageSize": "A4",                  // 纸张大小
    "margins": {                       // 页边距(mm)
      "top": 37,
      "bottom": 35,
      "left": 28,
      "right": 26
    }
  }
}
```

### 3.3 审核问题结构

```typescript
// 审核问题 (AuditRecord.issues) 结构定义
[
  {
    "id": "issue-uuid",                // 问题ID
    "type": "format|content|logic",    // 问题类型
    "severity": "high|medium|low",     // 严重程度
    "description": "问题描述",          // 问题说明
    "position": {                      // 位置信息
      "blockId": "block-uuid",         // 所在块ID
      "startOffset": 0,                // 起始偏移
      "endOffset": 10                  // 结束偏移
    },
    "suggestion": "修改建议",           // 建议内容
    "autoFixable": false               // 是否可自动修复
  }
]
```

---

## 4. 代码表定义

### CT-001 文档/模板类型代码表

| 代码 | 名称 | 说明 |
|------|------|------|
| notice | 通知 | 用于发布通知、公告 |
| report | 报告 | 工作报告、汇报材料 |
| request | 请示 | 向上级请示事项 |
| reply | 批复 | 对下级请示的答复 |
| letter | 函件 | 平级单位往来文书 |
| minutes | 会议纪要 | 会议记录和决议 |
| summary | 总结 | 工作总结 |
| plan | 计划 | 工作计划 |

### CT-002 文档状态代码表

| 代码 | 名称 | 说明 | 可转换状态 |
|------|------|------|------------|
| draft | 草稿 | 编辑中 | reviewing, final |
| reviewing | 审核中 | AI审核中 | draft, final |
| final | 已完成 | 编写完成 | draft |

### CT-003 环境代码表

| 代码 | 名称 | 颜色 | 说明 |
|------|------|------|------|
| public | 公网环境 | #1890FF (蓝色) | 使用云端AI服务 |
| private | 私域环境 | #52C41A (绿色) | 使用本地AI服务 |

### CT-004 图表类型代码表

| 代码 | 名称 | 说明 |
|------|------|------|
| flowchart | 流程图 | 工作流程、审批流程 |
| orgchart | 组织架构图 | 部门架构、人员组织 |
| mindmap | 思维导图 | 内容规划、要点梳理 |
| timeline | 时间轴 | 项目进度、历史沿革 |
| relation | 关系图 | 人物关系、业务关联 |

### CT-005 AI会话类型代码表

| 代码 | 名称 | 说明 |
|------|------|------|
| generate | 内容生成 | 生成公文内容 |
| continue | 续写 | 续写后续内容 |
| rewrite | 改写 | 润色、精简、扩展 |
| review | 审核 | 内容审核 |
| chat | 对话 | 自由对话交互 |

### CT-006 消息角色代码表

| 代码 | 名称 | 说明 |
|------|------|------|
| system | 系统 | 系统提示词 |
| user | 用户 | 用户输入 |
| assistant | 助手 | AI回复 |

### CT-007 审核类型代码表

| 代码 | 名称 | 说明 |
|------|------|------|
| content | 内容审核 | 检查内容质量和逻辑 |
| format | 格式审核 | 检查格式规范 |
| all | 全面审核 | 内容+格式综合审核 |

### CT-008 配置分类代码表

| 代码 | 名称 | 说明 |
|------|------|------|
| general | 常规设置 | 基本应用设置 |
| ai | AI设置 | AI服务配置 |
| security | 安全设置 | 安全相关配置 |
| ui | 界面设置 | 界面显示配置 |

### CT-009 审计事件类型代码表

| 代码 | 名称 | 说明 |
|------|------|------|
| env_switch | 环境切换 | 公网/私域切换 |
| ai_call | AI调用 | 调用AI服务 |
| doc_export | 文档导出 | 导出文档 |
| doc_create | 文档创建 | 创建新文档 |
| doc_delete | 文档删除 | 删除文档 |
| config_change | 配置变更 | 修改配置 |
| login | 登录 | 用户登录（预留） |
| logout | 登出 | 用户登出（预留） |

---

## 5. 数据关系定义

### 5.1 实体关系图

```
┌─────────────────────────────────────────────────────────────┐
│                       数据实体关系图                          │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌──────────┐        1:N        ┌──────────┐               │
│  │ Template │◄─────────────────│ Document │               │
│  │  (模板)  │     使用           │  (文档)  │               │
│  └──────────┘                   └────┬─────┘               │
│                                      │                      │
│                          ┌───────────┼───────────┐         │
│                          │           │           │         │
│                          │ 1:N       │ 1:N       │ 1:N     │
│                          ▼           ▼           ▼         │
│                    ┌──────────┐ ┌──────────┐ ┌──────────┐  │
│                    │  Chart   │ │AISession │ │AuditRecord│  │
│                    │  (图表)  │ │ (AI会话) │ │(审核记录) │  │
│                    └──────────┘ └────┬─────┘ └──────────┘  │
│                                      │                      │
│                                      │ 1:N                  │
│                                      ▼                      │
│                                ┌──────────┐                │
│                                │ Message  │                │
│                                │  (消息)  │                │
│                                └──────────┘                │
│                                                             │
│  ┌──────────┐                  ┌──────────┐                │
│  │UserConfig│                  │ AuditLog │                │
│  │(用户配置)│                  │(审计日志)│                │
│  └──────────┘                  └──────────┘                │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 5.2 关系说明

| 关系 | 类型 | 说明 | 外键 |
|------|------|------|------|
| Template → Document | 1:N | 一个模板可创建多个文档 | Document.template_id |
| Document → Chart | 1:N | 一个文档可包含多个图表 | Chart.document_id |
| Document → AISession | 1:N | 一个文档可关联多个AI会话 | AISession.document_id |
| Document → AuditRecord | 1:N | 一个文档可有多条审核记录 | AuditRecord.document_id |
| AISession → Message | 1:N | 一个会话包含多条消息 | Message.session_id |
| AISession → AuditRecord | 1:1 | 审核记录可关联AI会话 | AuditRecord.session_id |

### 5.3 级联规则

| 父表 | 子表 | 删除规则 | 说明 |
|------|------|----------|------|
| Document | Chart | CASCADE | 删除文档同时删除图表 |
| Document | AuditRecord | CASCADE | 删除文档同时删除审核记录 |
| AISession | Message | CASCADE | 删除会话同时删除消息 |
| Document | AISession | SET NULL | 删除文档后会话保留 |
| AISession | AuditRecord | SET NULL | 删除会话后审核记录保留 |
| Template | Document | 无 | 删除模板不影响已创建文档 |

---

## 附录：数据库文件位置

| 平台 | 数据库路径 |
|------|------------|
| Windows | `%APPDATA%\RedInk\data\redink.db` |
| macOS | `~/Library/Application Support/RedInk/data/redink.db` |
| Linux | `~/.config/RedInk/data/redink.db` |

---

*文档结束*
