# 集成测试规范

## 文档信息

| 项目 | 内容 |
|------|------|
| 文档版本 | V1.0 |
| 创建日期 | 2026-02-28 |

---

## 1. 测试范围

集成测试关注模块间的交互，包括：
- Store 与 Service 的协作
- 组件与 Store 的数据流
- 多个组件的协同工作

---

## 2. 测试示例

### 2.1 Store + Service 集成

```typescript
describe('DocumentStore Integration', () => {
  beforeEach(() => {
    // 设置 Mock API 响应
    server.use(
      http.get('/api/documents', () => {
        return HttpResponse.json({
          success: true,
          data: { items: mockDocuments },
        });
      })
    );
  });

  it('should load documents from API and update store', async () => {
    const { result } = renderHook(() => useDocumentStore());
    
    await act(async () => {
      await result.current.loadDocuments();
    });
    
    expect(result.current.documents).toHaveLength(2);
    expect(result.current.isLoading).toBe(false);
  });
});
```

### 2.2 组件交互集成

```typescript
describe('Document Edit Flow', () => {
  it('should save document when user edits and saves', async () => {
    render(
      <Providers>
        <DocumentEditor documentId="1" />
      </Providers>
    );
    
    // 编辑内容
    const editor = screen.getByRole('textbox');
    await userEvent.type(editor, '新增内容');
    
    // 点击保存
    const saveButton = screen.getByText('保存');
    await userEvent.click(saveButton);
    
    // 验证保存成功
    await waitFor(() => {
      expect(screen.getByText('已保存')).toBeInTheDocument();
    });
  });
});
```

---

## 3. 环境配置

### 3.1 测试数据库

集成测试使用内存 SQLite：

```typescript
// test/setup.ts
beforeEach(async () => {
  await db.exec(`
    CREATE TABLE documents (...);
    INSERT INTO documents VALUES (...);
  `);
});

afterEach(async () => {
  await db.exec('DROP TABLE documents');
});
```

### 3.2 Mock Server

```typescript
// test/mocks/server.ts
import { setupServer } from 'msw/node';
import { handlers } from './handlers';

export const server = setupServer(...handlers);
```

---

## 4. 运行命令

```bash
# 运行集成测试
pnpm test:integration

# 指定模块
pnpm test:integration --filter=document
```

---

*文档结束*
